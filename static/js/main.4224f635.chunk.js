(this["webpackJsonpmovies-app"]=this["webpackJsonpmovies-app"]||[]).push([[0],{117:function(e,t,a){e.exports=a(221)},123:function(e,t,a){},125:function(e,t,a){},126:function(e,t,a){},128:function(e,t,a){},190:function(e,t,a){},191:function(e,t,a){},216:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(12),c=a.n(o),s=a(26),i=a(31),u=a(34),l=a(33),m=(a(122),a(123),a(124),a(226)),v=a(233),p=(a(125),a(229)),g=(a(126),a(90)),h=(a(128),a(228));var d=function(e){var t=e.total,a=e.onChange,r=e.current;return 0===t?null:n.a.createElement(h.a,{size:"small",pageSize:"1",total:t,showSizeChanger:!1,onChange:a,current:r,className:"page-controller"})},f=a(116),y=(a(190),a(46)),E=(a(191),a(227)),M=a(113),b=a(232),k=a(231),w=a(230),N=n.a.createContext(),S=N.Provider,j=N.Consumer;function O(e){var t,a=e.value;return""===a||"0"===a?null:n.a.createElement("div",{className:"vote ".concat((t=a,t>7?"vote-higher-7":t>5?"vote-higher-5":t>3?"vote-higher-3":"vote-lower-3"))},a)}function C(e){var t=e.img,a=""===t?n.a.createElement(y.a,null):n.a.createElement("img",{src:t,alt:""});return n.a.createElement("div",{className:"movie-poster"},n.a.createElement("div",{className:"movie-poster__img-wrapper"},a))}function B(e){var t=e.genreList,a=e.genreIds;return n.a.createElement("div",{className:"tags"},a.reduce((function(e,a){var r=t.get(a);return r&&e.push(n.a.createElement(b.a,{key:a},r)),e}),[]))}var D=function(e){var t=e.data,a=e.rateMovie,r=t.img,o=t.title,c=t.date,s=t.overview,i=t.vote,u=t.rating,l=t.genreIds;return n.a.createElement("div",{className:"movie-block"},n.a.createElement(C,{img:r}),n.a.createElement("div",{className:"movie-description"},n.a.createElement("div",{className:"col-1"},n.a.createElement("div",{className:"description-img-wrapper"},n.a.createElement("img",{src:r,alt:""})),n.a.createElement("div",{className:"main-info-wrapper"},n.a.createElement("div",{className:"title"},o),n.a.createElement("div",{className:"date"},function(e){try{var t=new Date(e);return Object(E.a)({locale:M.a},"MMMM d, yyyy")(t)}catch(a){return e}}(c)),n.a.createElement(j,null,(function(e){return n.a.createElement(B,{genreList:e,genreIds:l})}))),n.a.createElement(O,{value:i})),n.a.createElement("div",{className:"col-2"},n.a.createElement("span",{className:"overview"},function(e){for(var t,a=225,r=e.slice(0,a),n=!1;!n;)(t=r[a-1])>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"?a-=1:n=!0;return(r=r.slice(0,a))+(e.length!==r.length?"...":"")}(s))),n.a.createElement("div",{className:"col-3"},n.a.createElement(k.a,{allowHalf:!0,count:10,defaultValue:"number"===typeof u?u:0,character:n.a.createElement(w.a,{className:"star-filled"}),onChange:a}))))};function _(e){var t=e.movieBlocksData,a=e.loading,r=e.error,o=e.errorMessage,c=e.rateMovie;return n.a.createElement("div",{className:"movies"},function(){if(r){var e="Failed to fetch"===o?"No internet connection":"Server error";return n.a.createElement(v.a,{style:{marginTop:"50px",marginBottom:"100px"},message:"Error:",description:e,type:"error",showIcon:!0})}return a?n.a.createElement(m.a,{tip:"loading...",style:{marginTop:"60px",marginBottom:"100px"}}):t.length?t.map((function(e){var t=e.id,a=Object(f.a)(e,["id"]);return n.a.createElement(D,{key:t,data:a,rateMovie:function(e){c(t,e)}})})):n.a.createElement(y.a,{style:{marginTop:"60px",marginBottom:"100px"}})}())}_.defaultProps={movieBlocksData:[],loading:!1,error:!1,errorMessage:"",rateMovie:function(){}};var x=_,I=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={movieBlocksData:[],totalPages:0,query:"",page:1,loading:!1,error:!1,errorMessage:""},e.debouncedMoviesServiceGetMovies=Object(g.debounce)((function(t){var a=e.state,r=a.query,n=a.page,o=e.props.getMovies;t.query===r&&t.page===n||(e.setState({loading:!0}),o(r,n).then((function(t){var a=t.movieBlocksData,r=t.totalPages;e.setState({movieBlocksData:a,totalPages:r,loading:!1})})).catch((function(t){e.setState({error:!0,errorMessage:t.message})})))}),500),e.onChangePage=function(t){t>0&&e.setState({page:t})},e.onChangeQuery=function(t){var a=t.target.value.trimLeft();e.setState({query:a,page:1})},e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e,t){this.debouncedMoviesServiceGetMovies(t)}},{key:"render",value:function(){var e=this.state,t=e.totalPages,a=e.query,r=e.page,o=e.movieBlocksData,c=e.loading,s=e.error,i=e.errorMessage,u=this.onChangeQuery,l=this.onChangePage,m=this.props,v=m.className,p=m.rateMovie;return n.a.createElement("div",{className:"movie-page-search ".concat(v)},n.a.createElement("input",{type:"search",className:"movie-search",placeholder:"Type to search...",onChange:u,value:a}),n.a.createElement(x,{movieBlocksData:o,loading:c,error:s,errorMessage:i,rateMovie:p}),n.a.createElement(d,{total:t,onChange:l,current:r}))}}]),a}(n.a.Component),P=(a(216),function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={movieBlocksData:[],loading:!0,error:!1,errorMessage:""},e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this,a=this.props,r=a.getRatedMovies,n=a.className;e.className!==n&&r().then((function(e){var a=e.movieBlocksData;return t.setState({loading:!1,error:!1,movieBlocksData:a})})).catch((function(e){return t.setState({error:!0,errorMessage:e.message})}))}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.rateMovie,r=this.state,o=r.movieBlocksData,c=r.loading,s=r.error,i=r.errorMessage;return n.a.createElement("div",{className:"movie-page-rated ".concat(t)},n.a.createElement(x,{movieBlocksData:o,loading:c,error:s,errorMessage:i,rateMovie:a}))}}]),a}(n.a.Component)),K=n.a.createContext(),L=K.Provider,R=K.Consumer,T=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={switchKeys:["search"]},e.onClickMenu=function(t){e.setState({switchKeys:[t.key]})},e.getHideClassByName=function(t){return e.state.switchKeys.some((function(e){return e===t}))?"":"hidden"},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.guestSessionId,t=this.state.switchKeys,a=this.onClickMenu,r=this.getHideClassByName;return n.a.createElement("div",{className:"movie-page"},n.a.createElement("div",{className:"switch"},n.a.createElement(p.a,{onClick:a,selectedKeys:t,mode:"horizontal"},n.a.createElement(p.a.Item,{key:"search"},"Search"),n.a.createElement(p.a.Item,{key:"rated"},"Rated"))),n.a.createElement(R,null,(function(t){var a=t.getMovies,o=t.rateMovie,c=t.getRatedMovies;return n.a.createElement(n.a.Fragment,null,n.a.createElement(I,{className:r("search"),getMovies:a,rateMovie:function(t,a){return o(e,t,a)}}),n.a.createElement(P,{className:r("rated"),rateMovie:function(t,a){return o(e,t,a)},getRatedMovies:function(){return c(e)}}))})))}}]),a}(n.a.Component),q=a(25),G=a.n(q),J=a(45),z=function e(){var t=this;Object(s.a)(this,e),this.apiKey="639828d50e7b3c39e3270402fcde3061",this.url="https://api.themoviedb.org/3",this.urlImageDB="https://image.tmdb.org/t/p/w500",this.createSearchMoviesURL=function(e,a){var r="".concat(t.url,"/search/movie?api_key=").concat(t.apiKey),n=encodeURIComponent(e);return"".concat(r,"&query=").concat(n,"&page=").concat(a)},this.prepareMoviesJson=function(e){var a=e.results,r=e.total_pages;return{movieBlocksData:a.map((function(e){var a=null==e.poster_path?"":t.urlImageDB+e.poster_path;return{id:e.id,title:e.title,overview:e.overview,date:e.release_date,img:a,vote:"".concat(e.vote_average),rating:e.rating,genreIds:e.genre_ids}})),totalPages:r}},this.getMovies=function(){var e=Object(J.a)(G.a.mark((function e(a){var r,n=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:1,!(("string"===typeof a||a instanceof String)&&a.length>0)){e.next=3;break}return e.abrupt("return",fetch(t.createSearchMoviesURL(a,r)).then((function(e){return e.json()})).then((function(e){return t.prepareMoviesJson(e)})));case 3:return e.abrupt("return",{movieBlocksData:[],totalPages:0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createGuestSession=Object(J.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/authentication/guest_session/new?api_key=").concat(t.apiKey)).then((function(e){return e.json()})).then((function(e){return e.guest_session_id})));case 1:case"end":return e.stop()}}),e)}))),this.rateMovie=function(){var e=Object(J.a)(G.a.mark((function e(a,r,n){var o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o="".concat(t.url,"/movie/").concat(r,"/rating?api_key=").concat(t.apiKey),fetch("".concat(o,"&guest_session_id=").concat(a),{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({value:Number(n)})});case 2:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.getRatedMovies=function(){var e=Object(J.a)(G.a.mark((function e(a){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/guest_session/").concat(a,"/rated/movies?api_key=").concat(t.apiKey)).then((function(e){return e.json()})).then((function(e){return t.prepareMoviesJson(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getGenreList=Object(J.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/genre/movie/list?api_key=").concat(t.apiKey)).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))},A=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).moviesService=new z,e.genreList=null,e.state={loading:!0,guestSessionId:"",error:!1,errorMessage:""},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.moviesService.createGuestSession().then((function(t){return e.setState({guestSessionId:t})})),this.moviesService.getGenreList().then((function(t){var a=t.genres;e.genreList=a.reduce((function(e,t){var a=t.id,r=t.name;return e.set(a,r)}),new Map)}))]).then((function(){return e.setState({loading:!1})})).catch((function(t){return e.setState({error:!0,errorMessage:t.message})}))}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.guestSessionId,r=e.error,o=e.errorMessage,c=n.a.createElement("div",{className:"main-wrapper"},n.a.createElement(S,{value:this.genreList},n.a.createElement(L,{value:this.moviesService},n.a.createElement(T,{guestSessionId:a})))),s=n.a.createElement("div",{className:"loading-wrapper"},n.a.createElement(m.a,{tip:"loading..."})),i=n.a.createElement(v.a,{style:{marginTop:"50px",marginBottom:"100px"},message:"Error:",description:o,type:"error",showIcon:!0});return r?i:t?s:c}}]),a}(n.a.Component);a(220);c.a.render(n.a.createElement(A,null),document.getElementById("root"))}},[[117,1,2]]]);
//# sourceMappingURL=main.4224f635.chunk.js.map