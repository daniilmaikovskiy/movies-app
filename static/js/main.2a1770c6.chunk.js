(this["webpackJsonpmovies-app"]=this["webpackJsonpmovies-app"]||[]).push([[0],{117:function(e,t,a){e.exports=a(223)},123:function(e,t,a){},125:function(e,t,a){},126:function(e,t,a){},127:function(e,t,a){},129:function(e,t,a){},191:function(e,t,a){},192:function(e,t,a){},217:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){},223:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(12),c=a.n(o),s=a(26),i=a(31),u=a(34),l=a(33),v=(a(122),a(123),a(124),a(228)),m=(a(125),a(231)),p=(a(126),a(127),a(90)),g=(a(129),a(230));var h=function(e){var t=e.total,a=e.onChange,r=e.current;return 0===t?null:n.a.createElement(g.a,{size:"small",pageSize:"1",total:t,showSizeChanger:!1,onChange:a,current:r,className:"page-controller"})},d=a(116),f=(a(191),a(234)),y=a(46),E=(a(192),a(229)),M=a(113),b=a(235),k=a(233),w=a(232),S=n.a.createContext(),N=S.Provider,j=S.Consumer;function O(e){var t,a=e.value;return""===a||"0"===a?null:n.a.createElement("div",{className:"vote ".concat((t=a,t>7?"vote-higher-7":t>5?"vote-higher-5":t>3?"vote-higher-3":"vote-lower-3"))},a)}function C(e){var t=e.img,a=""===t?n.a.createElement(y.a,null):n.a.createElement("img",{src:t,alt:""});return n.a.createElement("div",{className:"movie-poster"},n.a.createElement("div",{className:"movie-poster__img-wrapper"},a))}function B(e){var t=e.genreList,a=e.genreIds;return n.a.createElement("div",{className:"tags"},a.reduce((function(e,a){var r=t.get(a);return r&&e.push(n.a.createElement(b.a,{key:a},r)),e}),[]))}var D=function(e){var t=e.data,a=e.rateMovie,r=t.img,o=t.title,c=t.date,s=t.overview,i=t.vote,u=t.rating,l=t.genreIds;return n.a.createElement("div",{className:"movie-block"},n.a.createElement(C,{img:r}),n.a.createElement("div",{className:"movie-description"},n.a.createElement("div",{className:"col-1"},n.a.createElement("div",{className:"description-img-wrapper"},n.a.createElement("img",{src:r,alt:""})),n.a.createElement("div",{className:"main-info-wrapper"},n.a.createElement("div",{className:"title"},o),n.a.createElement("div",{className:"date"},function(e){try{var t=new Date(e);return Object(E.a)({locale:M.a},"MMMM d, yyyy")(t)}catch(a){return e}}(c)),n.a.createElement(j,null,(function(e){return n.a.createElement(B,{genreList:e,genreIds:l})}))),n.a.createElement(O,{value:i})),n.a.createElement("div",{className:"col-2"},n.a.createElement("span",{className:"overview"},function(e){for(var t,a=225,r=e.slice(0,a),n=!1;!n;)(t=r[a-1])>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"?a-=1:n=!0;return(r=r.slice(0,a))+(e.length!==r.length?"...":"")}(s))),n.a.createElement("div",{className:"col-3"},n.a.createElement(k.a,{allowHalf:!0,count:10,defaultValue:"number"===typeof u?u:0,character:n.a.createElement(w.a,{className:"star-filled"}),onChange:a}))))};function I(e){var t=e.movieBlocksData,a=e.loading,r=e.error,o=e.errorMessage,c=e.rateMovie;return n.a.createElement("div",{className:"movies"},function(){if(r){var e="Failed to fetch"===o?"No internet connection":"Server error";return n.a.createElement(f.a,{style:{marginTop:"50px",marginBottom:"100px"},message:"Error:",description:e,type:"error",showIcon:!0})}return a?n.a.createElement(v.a,{tip:"loading...",style:{marginTop:"60px",marginBottom:"100px"}}):t.length?t.map((function(e){var t=e.id,a=Object(d.a)(e,["id"]);return n.a.createElement(D,{key:t,data:a,rateMovie:function(e){c(t,e)}})})):n.a.createElement(y.a,{style:{marginTop:"60px",marginBottom:"100px"}})}())}I.defaultProps={movieBlocksData:[],loading:!1,error:!1,errorMessage:"",rateMovie:function(){}};var _=I,x=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={movieBlocksData:[],totalPages:0,query:"",page:1,loading:!1,error:!1,errorMessage:""},e.debouncedMoviesServiceGetMovies=Object(p.debounce)((function(t){var a=e.state,r=a.query,n=a.page,o=e.props.getMovies;t.query===r&&t.page===n||(e.setState({loading:!0}),o(r,n).then((function(t){var a=t.movieBlocksData,r=t.totalPages;e.setState({movieBlocksData:a,totalPages:r,loading:!1})})).catch((function(t){e.setState({error:!0,errorMessage:t.message})})))}),500),e.onChangePage=function(t){t>0&&e.setState({page:t})},e.onChangeQuery=function(t){var a=t.target.value.trimLeft();e.setState({query:a,page:1})},e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e,t){this.debouncedMoviesServiceGetMovies(t)}},{key:"render",value:function(){var e=this.state,t=e.totalPages,a=e.query,r=e.page,o=e.movieBlocksData,c=e.loading,s=e.error,i=e.errorMessage,u=this.onChangeQuery,l=this.onChangePage,v=this.props,m=v.className,p=v.rateMovie;return n.a.createElement("div",{className:"movie-page-search ".concat(m)},n.a.createElement("input",{type:"search",className:"movie-search",placeholder:"Type to search...",onChange:u,value:a}),n.a.createElement(_,{movieBlocksData:o,loading:c,error:s,errorMessage:i,rateMovie:p}),n.a.createElement(h,{total:t,onChange:l,current:r}))}}]),a}(n.a.Component),P=(a(217),function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={movieBlocksData:[],loading:!0,error:!1,errorMessage:""},e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this,a=this.props,r=a.getRatedMovies,n=a.className;e.className!==n&&r().then((function(e){var a=e.movieBlocksData;return t.setState({loading:!1,error:!1,movieBlocksData:a})})).catch((function(e){return t.setState({error:!0,errorMessage:e.message})}))}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.rateMovie,r=this.state,o=r.movieBlocksData,c=r.loading,s=r.error,i=r.errorMessage;return n.a.createElement("div",{className:"movie-page-rated ".concat(t)},n.a.createElement(_,{movieBlocksData:o,loading:c,error:s,errorMessage:i,rateMovie:a}))}}]),a}(n.a.Component)),K=a(25),L=a.n(K),R=a(45),q=function e(){var t=this;Object(s.a)(this,e),this.apiKey="639828d50e7b3c39e3270402fcde3061",this.url="https://api.themoviedb.org/3",this.urlImageDB="https://image.tmdb.org/t/p/w500",this.createSearchMoviesURL=function(e,a){var r="".concat(t.url,"/search/movie?api_key=").concat(t.apiKey),n=encodeURIComponent(e);return"".concat(r,"&query=").concat(n,"&page=").concat(a)},this.prepareMoviesJson=function(e){var a=e.results,r=e.total_pages;return{movieBlocksData:a.map((function(e){var a=null==e.poster_path?"":t.urlImageDB+e.poster_path;return{id:e.id,title:e.title,overview:e.overview,date:e.release_date,img:a,vote:"".concat(e.vote_average),rating:e.rating,genreIds:e.genre_ids}})),totalPages:r}},this.getMovies=function(){var e=Object(R.a)(L.a.mark((function e(a){var r,n=arguments;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:1,!(("string"===typeof a||a instanceof String)&&a.length>0)){e.next=3;break}return e.abrupt("return",fetch(t.createSearchMoviesURL(a,r)).then((function(e){return e.json()})).then((function(e){return t.prepareMoviesJson(e)})));case 3:return e.abrupt("return",{movieBlocksData:[],totalPages:0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createGuestSession=Object(R.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/authentication/guest_session/new?api_key=").concat(t.apiKey)).then((function(e){return e.json()})).then((function(e){return e.guest_session_id})));case 1:case"end":return e.stop()}}),e)}))),this.rateMovie=function(){var e=Object(R.a)(L.a.mark((function e(a,r,n){var o;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o="".concat(t.url,"/movie/").concat(r,"/rating?api_key=").concat(t.apiKey),fetch("".concat(o,"&guest_session_id=").concat(a),{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({value:Number(n)})});case 2:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.getRatedMovies=function(){var e=Object(R.a)(L.a.mark((function e(a){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/guest_session/").concat(a,"/rated/movies?api_key=").concat(t.apiKey)).then((function(e){return e.json()})).then((function(e){return t.prepareMoviesJson(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getGenreList=Object(R.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(t.url,"/genre/movie/list?api_key=").concat(t.apiKey)).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))};var G=function(e){var t=e.switchKeys,a=e.guestSessionId,r=new q,o=r.getMovies,c=r.rateMovie,s=r.getRatedMovies,i=function(e){return t.some((function(t){return t===e}))?"":"hidden"};return n.a.createElement(n.a.Fragment,null,n.a.createElement(x,{className:i("search"),getMovies:o,rateMovie:function(e,t){return c(a,e,t)}}),n.a.createElement(P,{className:i("rated"),rateMovie:function(e,t){return c(a,e,t)},getRatedMovies:function(){return s(a)}}))},J=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).state={switchKeys:["search"]},e.onClickMenu=function(t){e.setState({switchKeys:[t.key]})},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.guestSessionId,t=this.state.switchKeys,a=this.onClickMenu;return n.a.createElement("div",{className:"movie-page"},n.a.createElement("div",{className:"switch"},n.a.createElement(m.a,{onClick:a,selectedKeys:t,mode:"horizontal"},n.a.createElement(m.a.Item,{key:"search"},"Search"),n.a.createElement(m.a.Item,{key:"rated"},"Rated"))),n.a.createElement(G,{guestSessionId:e,switchKeys:t}))}}]),a}(n.a.Component),T=n.a.createContext(),z=T.Provider;T.Consumer,a(221);var A=function(e){var t="Failed to fetch"===e.message?"No internet connection":"Server error";return n.a.createElement("div",{className:"error-alert-wrapper"},n.a.createElement(f.a,{className:"error-alert",message:"Error:",description:t,type:"error",showIcon:!0}))},U=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).moviesService=new q,e.state={loading:!0,guestSessionId:"",error:!1,errorMessage:"",genreList:null},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.moviesService.createGuestSession().then((function(t){return e.setState({guestSessionId:t})})),this.moviesService.getGenreList().then((function(t){var a=t.genres.reduce((function(e,t){var a=t.id,r=t.name;return e.set(a,r)}),new Map);e.setState({genreList:a})}))]).catch((function(t){return e.setState({error:!0,errorMessage:t.message})})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.guestSessionId,r=e.error,o=e.errorMessage,c=e.genreList;if(r)return n.a.createElement(A,{message:o});var s=n.a.createElement("div",{className:"main-wrapper"},n.a.createElement(N,{value:c},n.a.createElement(z,{value:this.moviesService},n.a.createElement(J,{guestSessionId:a})))),i=n.a.createElement("div",{className:"loading-wrapper"},n.a.createElement(v.a,{tip:"loading..."}));return t?i:s}}]),a}(n.a.Component);a(222);c.a.render(n.a.createElement(U,null),document.getElementById("root"))}},[[117,1,2]]]);
//# sourceMappingURL=main.2a1770c6.chunk.js.map